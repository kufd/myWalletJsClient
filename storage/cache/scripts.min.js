jQuery(function(e){e.datepicker.regional.en={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesGenitive:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""}}),jQuery(function(e){e.datepicker.regional.ru={closeText:"Закрыть",prevText:"&#x3c;Пред",nextText:"След&#x3e;",currentText:"Сегодня",monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesGenitive:["Січня","Лютого","Березня","Квітня","Травня","Червня","Липня","Серпня","Вересня","Жовтня","Листопада","Грудня"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],dayNames:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],dayNamesShort:["вск","пнд","втр","срд","чтв","птн","сбт"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],weekHeader:"Не",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""}}),jQuery(function(e){e.datepicker.regional.ua={closeText:"Закрити",prevText:"&#x3c;",nextText:"&#x3e;",currentText:"Сьогодні",monthNames:["Січень","Лютий","Березень","Квітень","Травень","Червень","Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"],monthNamesGenitive:["Січня","Лютого","Березня","Квітня","Травня","Червня","Липня","Серпня","Вересня","Жовтня","Листопада","Грудня"],monthNamesShort:["Січ","Лют","Бер","Кві","Тра","Чер","Лип","Сер","Вер","Жов","Лис","Гру"],dayNames:["неділя","понеділок","вівторок","середа","четвер","п’ятниця","субота"],dayNamesShort:["нед","пнд","вів","срд","чтв","птн","сбт"],dayNamesMin:["Нд","Пн","Вт","Ср","Чт","Пт","Сб"],weekHeader:"Не",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""}});var myWallet={templates:{},views:{},user:null,apiBaseUrl:"/v1",apiJsErrorsUrl:"/jsErrors",router:null,errors:{},lastException:null,availableLanguages:["ua","en"],translator:new Polyglot,translations:{}};myWallet.init=function(){this._initErrorHandler(),this._initUser(),this.views.main=new MainView,this.views.main.render(),this.views.login=new LoginView,this.views.about=new AboutView,this.views.register=new RegisterView,this.views.forgotPassword=new ForgotPasswordView,this.views.spendings=new SpendingsView,this.views.profile=new ProfileView,this.views.formAddSpending=new FormAddSpendingView,this.views.reports=new ReportsView,this.views.reportGroupBySpengingName=new ReportGroupBySpengingNameView,this.views.main.initAfterEvrithing();var e=Backbone.Router.extend({routes:{"":"login",login:"login",about:"about",register:"register",forgotPassword:"forgotPassword",spendings:"spendings",profile:"profile",reports:"reports",reportGroupBySpengingName:"reportGroupBySpengingName"},login:function(){myWallet.views.login.render()},about:function(){myWallet.views.about.render()},register:function(){myWallet.views.register.render()},forgotPassword:function(){myWallet.views.forgotPassword.render()},spendings:function(){myWallet.views.spendings.render()},profile:function(){myWallet.views.profile.render()},reports:function(){myWallet.views.reports.render()},reportGroupBySpengingName:function(){myWallet.views.reportGroupBySpengingName.render()}});this.router=new e,Backbone.history.start()},myWallet._initErrorHandler=function(){window.onerror=function(e,t,n){errorMsg=myWallet.lastException instanceof Exception?myWallet.lastException.getMessage():myWallet.getErrorMessage(myWallet.errors.UNKNOWN),myWallet.lastException=null,myWallet.errorMsg(errorMsg);var a={msg:e,lineNumber:n,usersMsg:errorMsg,pageUrl:document.URL,scriptUrl:t,user:myWallet.user?myWallet.user.get("login"):null,date:myWallet.now(),userAgent:navigator.userAgent};$.ajax({type:"POST",url:myWallet.apiJsErrorsUrl,async:!0,contentType:"application/json",data:JSON.stringify(a)})}},myWallet.now=function(){var e=new Date;return $.datepicker.formatDate("yy-mm-dd",e)+" "+e.getHours()+":"+e.getMinutes()+":"+("0"+e.getSeconds()).slice(-2)},myWallet.t=function(e){return this.translator.t(e)},myWallet.reloadTranslation=function(){this._setLangSettings(),this.views.main.render();for(var e in this.views)"main"!=e&&this.views[e].setElement("#page");var t=document.location.hash.slice(1);this.router.navigate("reports"),this.router.navigate(t,{trigger:!0})},myWallet._initUser=function(){this.user=new User,spendingsTop.initialize(),this.user.loginWithSavedLoginData(),this._setLangSettings()},myWallet._setLangSettings=function(){this.translator.extend(this.translations[this.user.get("lang")]),$.datepicker.setDefaults($.datepicker.regional[this.user.get("lang")])},myWallet.isUserLoggedIn=function(){return this.user.isLoggedIn()||this.router.navigate("login",{trigger:!0}),this.user.isLoggedIn()},myWallet.errorMsg=function(e){$.jboxmessage("Помилка!",e,"top","error")},myWallet.msg=function(e){$.jboxmessage("Повідомлення",e,"top")},myWallet.setErrors=function(e){this.errors=e},myWallet.getErrorMessage=function(e){return this.errors[e]?this.errors[e]:this.errors[1]},myWallet.processAjaxError=function(e){var t;if(502==e.status)t=new Exception(myWallet.getErrorMessage(myWallet.errors.CONNECTION),myWallet.errors.CONNECTION);else if(401==e.status)t=new Exception(myWallet.getErrorMessage(myWallet.errors.UNAUTHORIZED),myWallet.errors.UNAUTHORIZED);else try{t=new Exception(myWallet.getErrorMessage($.parseJSON(e.responseText).code),$.parseJSON(e.responseText).code)}catch(n){t=new Exception(myWallet.getErrorMessage(myWallet.errors.UNKNOWN),myWallet.errors.UNKNOWN)}myWallet.throwException(t)},myWallet.throwException=function(e){throw myWallet.lastException=e,myWallet.lastException},myWallet.getAuthHeader=function(e,t){return e=e?e:this.user.get("login"),t=t?t:this.user.get("password"),{Authorization:"Basic "+btoa(e+":"+t)}},myWallet.translations.en={"Мій гаманець":"My Wallet",Звіти:"Reports",Профіль:"Profile",Вихід:"Sign out","Додати витрату":"Add spending",Гаманець:"Wallet","Адмін-панель":"Admin-panel",Вхід:"Sign in",Логін:"Login","Ім’я":"Name",Мова:"Language",Валюта:"Currency","Шифрувати дані":"Encrypt data","Новий пароль":"New password","Повтор нового паролю":"Retype new password","Поточний пароль":"Current password",Зберегти:"Save",Період:"Period",Витрата:"Spending",Сума:"Amount",Дата:"Date",Дії:"Actions",Редагувати:"Edit",Видалити:"Delete","Загальна сума":"Total amount","Сервіс який допоможе підсумувати ваші витрати":"Service which can count money you spend","Більше інформації":"More information",Пароль:"Password","Запам’ятати":"Keep me signed in",Увійти:"Sign in","Забув пароль":"Forgot password",Зареєструватись:"Register","це сервіс з допомогою якого ви можете підсумовувати свої витрати за періоди часу":"service which can count money your spend for some period of time","А потім, з допомогою <b>MyWallet</b> внесені витрати можна групувати по днях та назвах і визначити на що ви найбільше витрачали грошей":"Then, with <b>MyWallet</b> you can group spendings by days and names. And you can see the biggest spendings","Всі цифри які ви вносите можуть шифруватись, але <b>у випадку втрати паролю цю інформацію не можна буде відновити</b>":"All amounts you save could be enncrypted, but <b>if you lose password it is imposible to get this information</b>",Реєстрація:"Sign up","Повтор пароля":"Retype password",Контакти:"Contacts",Увага:"Attention","При використанні процедури відновлення паролю буде втрачена зашифрована інформація":"If you use restore password process, encrypted information will be lost","Відровлення паролю":"Restore passwrod","Введіть ваш логін":"Enter your login",Відновити:"Restore","Сума по витратах":"Amount by spending name","Нова витрата":"New spending","Інша витрата":"another spending"},myWallet.translations.ua={"Мій гаманець":"Мій гаманець",Звіти:"Звіти",Профіль:"Профіль",Вихід:"Вихід","Додати витрату":"Додати витрату",Гаманець:"Гаманець","Адмін-панель":"Адмін-панель",Вхід:"Вхід",Логін:"Логін","Ім’я":"Ім’я",Мова:"Мова",Валюта:"Валюта","Шифрувати дані":"Шифрувати дані","Новий пароль":"Новий пароль","Повтор нового паролю":"Повтор нового паролю","Поточний пароль":"Поточний пароль",Зберегти:"Зберегти",Період:"Період",Витрата:"Витрата",Сума:"Сума",Дата:"Дата",Дії:"Дії",Редагувати:"Редагувати",Видалити:"Видалити","Загальна сума":"Загальна сума","Сервіс який допоможе підсумувати ваші витрати":"Сервіс який допоможе підсумувати ваші витрати","Більше інформації":"Більше інформації",Пароль:"Пароль","Запам’ятати":"Запам’ятати",Увійти:"Увійти","Забув пароль":"Забув пароль",Зареєструватись:"Зареєструватись","це сервіс з допомогою якого ви можете підсумовувати свої витрати за періоди часу":"це сервіс з допомогою якого ви можете підсумовувати свої витрати за періоди часу","А потім, з допомогою <b>MyWallet</b> внесені витрати можна групувати по днях та назвах і визначити на що ви найбільше витрачали грошей":"А потім, з допомогою <b>MyWallet</b> внесені витрати можна групувати по днях та назвах і визначити на що ви найбільше витрачали грошей","Всі цифри які ви вносите можуть шифруватись, але <b>у випадку втрати паролю цю інформацію не можна буде відновити</b>":"Всі цифри які ви вносите можуть шифруватись, але <b>у випадку втрати паролю цю інформацію не можна буде відновити</b>",Реєстрація:"Реєстрація","Повтор пароля":"Повтор пароля",Контакти:"Контакти",Увага:"Увага","При використанні процедури відновлення паролю буде втрачена зашифрована інформація":"При використанні процедури відновлення паролю буде втрачена зашифрована інформація","Відровлення паролю":"Відровлення паролю","Введіть ваш логін":"Введіть ваш логін",Відновити:"Відновити","Сума по витратах":"Сума по витратах","Нова витрата":"Нова витрата","Інша витрата":"Інша витрата"},function(){var e={1:"Невідома помилка",11:"Помилка при з’єднанні з сервером.",12:"Неправильний логін або пароль",101:"Довжина логіну має бути більшою 5 і меншою 50 символів",102:"Довжина імені має бути більшою 2 і меншою 100 символів",103:"Неправильний код мови",104:"Неправильний email",105:"Не введений пароль",106:"Не введено підтвердження паролю",107:"Не правильно задана опція шифрування даних",109:"Такий логін вже існує",110:"Такий email вже існує",111:"Пароль та його підтвердження не співпадають",112:"Неправильний пароль",114:"Введіть назву витрати",115:"Сума витрати має бути числом",116:"Не задана дата для витрати",UNKNOWN:1,CONNECTION:11,UNAUTHORIZED:12};myWallet.setErrors(e)}();var Exception=function(e,t){var t,e;this.getMessage=function(){return e},this.getCode=function(){return t}};Exception.prototype=new Error,Exception.prototype.constructor=Exception,$(document).ready(function(){myWallet.init()});var spendingsTop={url:myWallet.apiBaseUrl+"/spendings/top/",list:null,initialize:function(){myWallet.user.bind("login:success",function(){spendingsTop.load()})},load:function(){var e=this;$.ajax({type:"GET",url:this.url,async:!0,headers:myWallet.getAuthHeader(),data:{},dataType:"json",error:myWallet.processAjaxError,success:function(t){e.list=t}})},get:function(){return this.list}},User=Backbone.Model.extend({urlAuth:myWallet.apiBaseUrl+"/auth-users/",url:myWallet.apiBaseUrl+"/users/",defaults:{login:null,password:null,name:null,email:null,role:null,lang:"en",currency:null,useEncryption:null,authorized:!1},isLoggedIn:function(){return this.get("loggedIn")},login:function(e,t,n){var a=this;$.ajax({type:"GET",url:this.urlAuth,async:!1,headers:myWallet.getAuthHeader(e,t),data:{},dataType:"json",success:function(e){a.set(e),a.set("loggedIn",!0),a.set("password",t),a.trigger("login:success")},error:myWallet.processAjaxError}),this.isLoggedIn()&&n&&this._saveLoginData()},logout:function(){this.clear(),this._removeLoginData(),this.set("loggedIn",!1),this.trigger("logout")},register:function(e){$.ajax({type:"POST",url:this.url,async:!1,data:e,dataType:"json",success:function(){myWallet.router.navigate("login",{trigger:!0})},error:myWallet.processAjaxError})},patch:function(e){var t=this,n=this.url+t.get("login")+"/",a=!1;return $.ajax({type:"PATCH",url:n,async:!1,headers:myWallet.getAuthHeader(),data:e,dataType:"json",success:function(){t.set(e),e.newPassword&&(t.set("password",e.newPassword),t._getSavedLoginData()&&t._saveLoginData()),a=!0},error:myWallet.processAjaxError}),a},_getSavedLoginData:function(){return $.localStorage.isSet(["login","password"])?$.localStorage.get(["login","password"]):null},_saveLoginData:function(){$.localStorage.set({login:this.get("login"),password:this.get("password")})},_removeLoginData:function(){return $.localStorage.remove(["login","password"])},loginWithSavedLoginData:function(){this._getSavedLoginData()&&this.login(this._getSavedLoginData().login,this._getSavedLoginData().password)}}),Spending=Backbone.Model.extend({url:myWallet.apiBaseUrl+"/spendings/",defaults:{amount:null,spendingNameId:null,date:null,userId:null,spendingName:null,id:null},destroy:function(){var e=this;$.ajax({type:"DELETE",url:this.url+e.get("id")+"/",async:!1,headers:myWallet.getAuthHeader(),data:{},dataType:"json",error:myWallet.processAjaxError})},save:function(e,t){return e=e||{},t=t||{},t.headers=myWallet.getAuthHeader(),t.async=!1,t.patch=!0,t.wait=!0,this.isNew()||(t.url=this.url+this.get("id")),Backbone.Model.prototype.save.call(this,e,t)}}),reportGroupBySpengingName={_data:null,_url:myWallet.apiBaseUrl+"/reports/group-by-spending-name/",_sortOptions:{field:"amount",direction:"desc"},_dateBegin:null,_dateEnd:null,_loadData:function(){var e=this;$.ajax({type:"GET",url:this._url,async:!1,headers:myWallet.getAuthHeader(),data:{dateBegin:this._dateBegin,dateEnd:this._dateEnd},dataType:"json",success:function(t){e._data=t.data,e._sort()},error:myWallet.processAjaxError})},_sort:function(){this._data=_.sortBy(this._data,this.getSortOptions().field),"desc"==this.getSortOptions().direction&&(this._data=this._data.reverse())},setSortOptions:function(e){this._sortOptions=e,this._sort()},setDateBegin:function(e){this._data=null,this._dateBegin=e},setDateEnd:function(e){this._data=null,this._dateEnd=e},getSortOptions:function(){return this._sortOptions},getDateBegin:function(){return this._dateBegin},getDateEnd:function(){return this._dateEnd},getData:function(){return null==this._data&&this._loadData(),this._data}},Spendings=Backbone.Collection.extend({model:Spending,url:myWallet.apiBaseUrl+"/spendings/",sortOptions:{field:"date",direction:"desc"},fetch:function(e,t){var n=this;$.ajax({type:"GET",url:this.url,async:!1,headers:myWallet.getAuthHeader(),data:{dateBegin:e,dateEnd:t},dataType:"json",success:function(e){n.set(e.spendings)},error:myWallet.processAjaxError})},deleteSpending:function(e){var t=this.get(e);t.destroy(),this.remove(t)},comparator:function(e,t){var n=0,a=e.get(this.sortOptions.field),i=t.get(this.sortOptions.field),s=e.get("id"),r=t.get("id");return"amount"==this.sortOptions.field&&(a=parseFloat(a),i=parseFloat(i)),a>i||a==i&&s>r?n=1:(i>a||a==i&&r>s)&&(n=-1),"desc"==this.sortOptions.direction&&(n=-n),n}});myWallet.templates.about=_.template('<div class="about">		<p>			<b>MyWallet</b> - <%=myWallet.t("це сервіс з допомогою якого ви можете підсумовувати свої витрати за періоди часу")%>.			<br/>			<%=myWallet.t("А потім, з допомогою <b>MyWallet</b> внесені витрати можна групувати по днях та назвах і визначити на що ви найбільше витрачали грошей")%>.		</p>		<p>			<%=myWallet.t("Всі цифри які ви вносите можуть шифруватись, але <b>у випадку втрати паролю цю інформацію не можна буде відновити</b>")%>.		</p>	</div>'),myWallet.templates.forgotPassword=_.template('<div class="forgotPassword">		<div class="alert">			<h2><%=myWallet.t("Увага")%>!</h3>			<%=myWallet.t("При використанні процедури відновлення паролю буде втрачена зашифрована інформація")%>.		</div>		<div class="form">			<h3><%=myWallet.t("Відровлення паролю")%></h3>			<table>			<tr>				<td><%=myWallet.t("Введіть ваш логін")%></td>				<td><input type="text" name="login"></td>			</tr>			<tr>				<td colspan="2" class="submit">					<input type="button" value="<%=myWallet.t("Відновити")%>" />				</td>			</tr>			</table>		</div>	</div>'),myWallet.templates.formAddSpending='<div class="formAddSpending" title="<%=myWallet.t("Нова витрата")%>">		<table>		<tr>			<td class="name"><%=myWallet.t("Витрата")%></td>			<td class="value">				<% if(!spendingsTop.get()){ %>					<input type="text" name="spendingName" />				<% }else{ %>					<select name="spendingName">						<% $.each(spendingsTop.get(), function(index, spendingTopName) { %>							<option value="<%=spendingTopName%>"><%=spendingTopName%></option>						<% }); %>						<option value=""><%=myWallet.t("Інша витрата")%></option>					</select>				<% } %>			</td>		</tr>		<tr>			<td class="name"><%=myWallet.t("Сума")%></td>			<td class="value"><input type="text" name="amount" value="" /></td>		</tr>		<tr>			<td class="name"><%=myWallet.t("Дата")%></td>			<td class="value">				<input type="text" name="dateFront" value="" readonly="readonly" />				<input type="hidden" name="date" value="" />			</td>		</tr>		</table>		<input type="hidden" name="spendingId" value="" />	</div>',myWallet.templates.login=_.template('<div class="login">		<p class="about">			<%=myWallet.t("Сервіс який допоможе підсумувати ваші витрати")%>.			<a href="#about">				<%=myWallet.t("Більше інформації")%>.			</a>		</p>		<div class="form">			<h3><%=myWallet.t("Вхід")%></h3>			<table>			<tr>				<td><%=myWallet.t("Логін")%></td>				<td><input type="text" name="login"></td>			</tr>			<tr>				<td><%=myWallet.t("Пароль")%></td>				<td><input type="password" name="password"></td>			</tr>			<tr>				<td></td>				<td><label><input type="checkbox" name="remember"> <%=myWallet.t("Запам’ятати")%></label></td>			</tr>			<tr>				<td colspan="2" class="submit">					<input type="button" value="<%=myWallet.t("Увійти")%>" />				</td>			</tr>			<tr>				<td colspan="2">					<a href="#forgotPassword" class="forgot"><%=myWallet.t("Забув пароль")%></a>					<a href="#register" class="register">						<%=myWallet.t("Зареєструватись")%>					</a>				</td>			</tr>			</table>		</div>	</div>'),myWallet.templates.main=_.template('<!-- start header -->	<div id="header">		<div id="logo">			<h1><a href="#spendings"><%=myWallet.t("Мій гаманець")%><sup></sup></a></h1>			<h2></h2>		</div>		<div id="menu">			<ul>				<li><a href="#reports" class="reports"><%=myWallet.t("Звіти")%></a></li>				<li><a href="#spendings" class="spendings"><%=myWallet.t("Гаманець")%></a></li>				<li><a href="#profile" class="profile"><%=myWallet.t("Профіль")%></a></li>				<li><a href="#" class="controlPanel"><%=myWallet.t("Адмін-панель")%></a></li>				<li><a href="#login" class="login"><%=myWallet.t("Вхід")%></a></li>				<li><a href="#" class="logout"><%=myWallet.t("Вихід")%></a></li>			</ul>		</div>	</div>	<!-- end header -->	<!-- start page -->	<div id="page">	</div>	<!-- end page -->	<!-- start footer -->	<div id="footer">		<div id="footer-menu">			<!--ul>				<li class="active"><a href="index.html">головна</a></li>			</ul-->		</div>		<div class="contacts"><%=myWallet.t("Контакти")%>: <a href="mailto:mywallet.service@gmail.com">mywallet.service@gmail.com</a></div>		<p id="legal">(c) 2013 mywallet.com. Design by <a href="http://www.freecsstemplates.org/" target="_blank">Free CSS Templates</a>.</p>	</div>	<!-- end footer -->'),myWallet.templates.profile='<div class="profile">		<h3><%=myWallet.t("Профіль")%></h3>		<table>		<tr>			<td><%=myWallet.t("Логін")%></td>			<td><input type="text" name="login" readonly="readonly" value="<%=user.get(\'login\')%>"/></td>		</tr>		<tr>			<td><%=myWallet.t("Ім’я")%></td>			<td><input type="text" name="name" value="<%=user.get(\'name\')%>"/></td>		</tr>		<tr>			<td>e-mail</td>			<td><input type="text" name="email" value="<%=user.get(\'email\')%>"/></td>		</tr>		<tr>			<td><%=myWallet.t("Мова")%></td>			<td>				<select name="lang">					<% for (var i in availableLanguages) { %>						<% var lang = availableLanguages[i]; %>						<option value="<%=lang%>" <%=user.get(\'lang\') == lang ? \'selected="selected"\' : \'\'%>><%=lang%></option>					<% } %>				</select>			</td>		</tr>		<tr>			<td><%=myWallet.t("Валюта")%></td>			<td><input type="text" name="currency" value="<%=user.get(\'currency\')%>"/></td>		</tr>		<tr>			<td><%=myWallet.t("Шифрувати дані")%></td>			<td><input type="checkbox" name="useEncryption" <%=user.get(\'useEncryption\')==1 ? \'checked="checked"\' : \'\'%> title="При активації цієї опції будуть зашифровані цифри витрат. Але при втраті паролю, їх не можна буде відновити"/></td>		</tr>		<tr>			<td class="pt-15"><%=myWallet.t("Новий пароль")%></td>			<td class="pt-15"><input type="password" name="newPassword"/></td>		</tr>		<tr>			<td><%=myWallet.t("Повтор нового паролю")%></td>			<td><input type="password" name="confirmNewPassword"/></td>		</tr>		<tr>			<td class="pt-15"><%=myWallet.t("Поточний пароль")%></td>			<td class="pt-15"><input type="password" name="password"/></td>		</tr>		<tr>			<td colspan="2" class="submit">				<input type="button" value="<%=myWallet.t("Зберегти")%>" />			</td>		</tr>		</table>	</div>',myWallet.templates.register=_.template('<div class="register">		<h3><%=myWallet.t("Реєстрація")%></h3>		<table>		<tr>			<td><%=myWallet.t("Логін")%></td>			<td><input type="text" name="login"></td>		</tr>		<tr>			<td><%=myWallet.t("Ім’я")%></td>			<td><input type="text" name="name"></td>		</tr>		<tr>			<td>e-mail</td>			<td><input type="text" name="email"></td>		</tr>		<tr>			<td><%=myWallet.t("Пароль")%></td>			<td><input type="text" name="password"></td>		</tr>		<tr>			<td><%=myWallet.t("Повтор пароля")%></td>			<td><input type="text" name="confirmPassword"></td>		</tr>		<tr>			<td colspan="2" class="submit">				<input type="button" value="<%=myWallet.t("Зареєструватись")%>" />			</td>		</tr>		</table>	</div>'),myWallet.templates.reportGroupBySpengingName='<div class="reportGroupBySpengingName">		<h2>Звіт: сума по витратах</h2>		<div class="tool_panel">			Період: 			<input name="dateBeginFront" type="text">			<input type="hidden" name="dateBegin" />			&mdash;			<input name="dateEndFront" type="text">			<input type="hidden" name="dateEnd" />		</div>		<table class="spendings">		<tr>			<th class="spendingName">				<div data-field="spendingName" class="<%=sortOptions.field == "spendingName" ? sortOptions.direction : ""%>">Витрата</div>			</th>			<th class="amount">				<div data-field="amount" class="<%=sortOptions.field == "amount" ? sortOptions.direction : ""%>">Сума</div>			</th>		</tr>		<% var sum = 0; %>		<% for (var key in data) { %>			<% spending = data[key]; %>			<% sum+=parseInt(spending.amount*100); %>			<tr>				<td class="spendingName">					<%=spending.spendingName%>				</td>				<td class="amount">					<%=spending.amount%>  <%=user.get("currency")%>				</td>			</tr>		<% } %>		<tr class="sum">			<td class="spendingName">				Загальна сума			</td>			<td class="amount">				<%=sum/100%> <%=user.get("currency")%>			</td>		</tr>		</table>	</div>',myWallet.templates.reports='<div class="reports">		<ul>			<li><a href="#reportGroupBySpengingName"><%=myWallet.t("Сума по витратах")%></a></li>		</ul>	</div>',myWallet.templates.spendings='<div class="spendings">		<div class="tool_panel">			<div class="button_add_spending"><%=myWallet.t("Додати витрату")%></div>			<div class="dateFilter">				<h5><%=myWallet.t("Період")%>:</h5>				<input type="text" name="dateBeginFront" />				<input type="hidden" name="dateBegin" />				&mdash;				<input type="text" name="dateEndFront" />				<input type="hidden" name="dateEnd" />			</div>		</div>		<table class="spendings">		<tr>			<th class="spendingName">				<div data-field="spendingName" class="<%=sortOptions.field == "spendingName" ? sortOptions.direction : ""%>"><%=myWallet.t("Витрата")%></div>			</th>			<th class="amount">				<div data-field="amount" class="<%=sortOptions.field == "amount" ? sortOptions.direction : ""%>"><%=myWallet.t("Сума")%></div>			</th>			<th class="date">				<div data-field="date" class="<%=sortOptions.field == "date" ? sortOptions.direction : ""%>"><%=myWallet.t("Дата")%></div>			</th>			<th class="actions">				<%=myWallet.t("Дії")%>			</th>		</tr>		<% var sum = 0; %>		<% spendings.each(function(spending) { %>		<% sum+=parseInt(spending.get("amount")*100); %>		<tr data-spending-id="<%=spending.get("id")%>">			<td class="spendingName">				<%=spending.get("spendingName")%>			</td>			<td class="amount">			<%=spending.get("amount")%>  <%=user.get("currency")%>			</td>			<td class="date">				<%=$.datepicker.formatDate("d GG yy", new Date(spending.get("date")))%>			</td>			<td class="actions">				<div class="edit" title="<%=myWallet.t("Редагувати")%>">&nbsp;</div>				<div class="delete" title="<%=myWallet.t("Видалити")%>">&nbsp;</div>			</td>		</tr>		<% }); %>		<tr class="sum">			<td class="spendingName">				<%=myWallet.t("Загальна сума")%>			</td>			<td class="amount">				<%=sum/100%> <%=user.get("currency")%>			</td>			<td class="date">			</td>			<td class="actions">			</td>		</tr>		</table>	</div>';var MainView=Backbone.View.extend({el:"body",template:myWallet.templates.main,events:{"click .logout":"logout"},initialize:function(){},render:function(){this.$el.html(this.template())},logout:function(){myWallet.user.logout()},initAfterEvrithing:function(){var e=this;myWallet.views.spendings.bind("render",function(){e.$("a.spendings, a.login").hide(),e.$("a.reports, a.logout, a.profile").show()}),myWallet.views.login.bind("render",function(){e.$("a.login, a.logout, a.spendings, a.profile, a.reports").hide()}),myWallet.views.register.bind("render",function(){e.$("a.logout, a.spendings, a.profile, a.reports").hide(),e.$("a.login").show()}),myWallet.views.about.bind("render",function(){e.$("a.logout, a.spendings, a.profile, a.reports").hide(),e.$("a.login").show()}),myWallet.views.profile.bind("render",function(){e.$("a.login, a.profile").hide(),e.$("a.reports, a.logout, a.spendings").show()}),myWallet.views.forgotPassword.bind("render",function(){e.$("a.profile, a.logout, a.spendings, a.reports").hide(),e.$("a.login").show()}),myWallet.views.reports.bind("render",function(){e.$("a.reports, a.login").hide(),e.$("a.spendings, a.logout, a.profile").show()})}}),LoginView=Backbone.View.extend({el:"#page",rootEl:"div.login",template:myWallet.templates.login,events:{"click div.login .submit input":"login","keyup div.login div.form table":function(e){13==e.which&&this.login()}},initialize:function(){myWallet.user.bind("logout",function(){myWallet.router.navigate("#login",{trigger:!0})})},render:function(){myWallet.isUserLoggedIn()?myWallet.router.navigate("#spendings",{trigger:!0}):(this.trigger("render"),this.$el.html(this.template()))},login:function(){this.$("input[name=login]").val()||myWallet.throwException(new Exception("Введіть логін")),this.$("input[name=password]").val()||myWallet.throwException(new Exception("Введіть пароль")),myWallet.user.login(this.$("input[name=login]").val(),this.$("input[name=password]").val(),this.$("input[name=remember]").is(":checked"))}}),AboutView=Backbone.View.extend({el:"#page",template:myWallet.templates.about,render:function(){this.trigger("render"),this.$el.html(this.template())}}),RegisterView=Backbone.View.extend({el:"#page",rootEl:"div.register",template:myWallet.templates.register,events:{"click div.register .submit input":"register"},render:function(){this.trigger("render"),this.$el.html(this.template())},register:function(){myWallet.user.register({login:this.$("input[name=login]").val(),name:this.$("input[name=name]").val(),email:this.$("input[name=email]").val(),password:this.$("input[name=password]").val(),confirmPassword:this.$("input[name=confirmPassword]").val(),lang:"ua",currency:"грн",useEncryption:"0"})}}),ForgotPasswordView=Backbone.View.extend({el:"#page",template:myWallet.templates.forgotPassword,render:function(){this.trigger("render"),this.$el.html(this.template())}}),SpendingsView=Backbone.View.extend({el:"#page",template:myWallet.templates.spendings,spendings:null,dateBegin:null,dateEnd:null,events:{"click div.spendings table.spendings .delete":"deleteSpending","click div.spendings div.tool_panel .button_add_spending":"showFormAddSpending","click div.spendings table.spendings div.edit":"showFormEditSpending","click div.spendings table.spendings th div":"sortSpendings"},initialize:function(){myWallet.user.bind("login:success",function(){myWallet.router.navigate("spendings",{trigger:!0})}),this.dateBegin=$.datepicker.formatDate("yy-mm-01",new Date),this.dateEnd=$.datepicker.formatDate("yy-mm-"+this.countDaysOfMont(),new Date)},countDaysOfMont:function(){var e=new Date;return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()},render:function(){if(myWallet.isUserLoggedIn()){this._getSpendings().sort();var e=_.template(this.template,{spendings:this._getSpendings(),user:myWallet.user,sortOptions:this.spendings.sortOptions});this.$el.html(e),this.$("div.tool_panel .button_add_spending").button();var t=this;this.$("input[name=dateBegin]").val(this.dateBegin),this.$("input[name=dateBeginFront]").val($.datepicker.formatDate("d GG yy",new Date(this.dateBegin))).datepicker({dateFormat:"d GG yy",altField:this.$("input[name=dateBegin]"),altFormat:"yy-mm-dd",onClose:function(){t.dateBegin=t.$("input[name=dateBegin]").val(),t._getSpendings(!0),t.render()}}),this.$("input[name=dateEnd]").val(this.dateEnd),this.$("input[name=dateEndFront]").val($.datepicker.formatDate("d GG yy",new Date(this.dateEnd))).datepicker({dateFormat:"d GG yy",altField:this.$("input[name=dateEnd]"),altFormat:"yy-mm-dd",onClose:function(){t.dateEnd=t.$("input[name=dateEnd]").val(),t._getSpendings(!0),t.render()}}),this.trigger("render")}},deleteSpending:function(e){var t=$(e.target).parents("tr").attr("data-spending-id");this._getSpendings().deleteSpending(t),this.render()},_getSpendings:function(e){return(e||null==this.spendings)&&(this.spendings=new Spendings,this.spendings.fetch(this.dateBegin,this.dateEnd)),this.spendings},showFormAddSpending:function(){myWallet.views.formAddSpending.render()},showFormEditSpending:function(e){var t=$(e.target).parents("tr").attr("data-spending-id"),n=this._getSpendings().get(t);myWallet.views.formAddSpending.render(n)},saveSpending:function(e,t){var n=this._getSpendings().get(e);n=n||new Spending,n.save(t,{success:function(e,t){n.isNew()&&n.set("id",t.spendingId)},error:function(e,t){myWallet.processAjaxError(t,null,null)}}),this.trigger("spending:save:success"),this._getSpendings().add(n),this.render()},sortSpendings:function(e){var t=$(e.target).attr("data-field");this.spendings.sortOptions.field==t?this.spendings.sortOptions.direction="asc"==this.spendings.sortOptions.direction?"desc":"asc":(this.spendings.sortOptions.direction="desc",this.spendings.sortOptions.field=t),this.render()}}),ProfileView=Backbone.View.extend({el:"#page",template:myWallet.templates.profile,events:{"click div.profile .submit input":"save"},render:function(){if(myWallet.isUserLoggedIn()){var e=_.template(this.template,{user:myWallet.user,availableLanguages:myWallet.availableLanguages});this.$el.html(e),this.trigger("render")}},save:function(){var e={name:this.$("input[name=name]").val(),email:this.$("input[name=email]").val(),lang:this.$("select[name=lang]").val(),currency:this.$("input[name=currency]").val(),useEncryption:this.$("input[name=useEncryption]").prop("checked")?"1":"0",newPassword:this.$("input[name=newPassword]").val(),confirmNewPassword:this.$("input[name=confirmNewPassword]").val(),password:this.$("input[name=password]").val()};myWallet.user.patch(e)&&(myWallet.reloadTranslation(),myWallet.msg("Профіль збережено")),this.$("input[name=password], input[name=newPassword], input[name=confirmNewPassword]").val("")
}}),FormAddSpendingView=Backbone.View.extend({el:"body",template:myWallet.templates.formAddSpending,urlAutocomplete:"/v1/spendings/autocomplete/",cacheAutocoplete:{},events:{"click div.formAddSpending select[name=spendingName]":"selectSpendingName"},initialize:function(){var e=this;myWallet.views.spendings.bind("spending:save:success",function(){e.remove()})},render:function(e){var t=this,n=_.template(this.template);this.$el.append(n),e instanceof Spending?(-1==$.inArray(e.get("spendingName"),spendingsTop.get())&&this.replaceSpengingNameSelectByInput(),this.$("input[name=spendingName], select[name=spendingName]").val(e.get("spendingName")),this.$("input[name=amount]").val(e.get("amount")),this.$("input[name=date]").val(e.get("date")),this.$("input[name=dateFront]").val($.datepicker.formatDate("d GG yy",new Date(e.get("date")))),this.$("input[name=spendingId]").val(e.get("id"))):(this.$("input[name=date]").val($.datepicker.formatDate("yy-mm-dd",new Date)),this.$("input[name=dateFront]").val($.datepicker.formatDate("d GG yy",new Date))),this.$("input[name=dateFront]").datepicker({dateFormat:"d GG yy",altField:this.$("input[name=date]"),altFormat:"yy-mm-dd"}),this.$("div.formAddSpending").dialog({buttons:[{text:"Зберегти",click:function(){t.saveSpending()}},{text:"Відмінити",click:function(){t.remove()}}],close:function(){t.remove()},modal:!0,width:320})},remove:function(){$("div.formAddSpending").remove()},saveSpending:function(){myWallet.views.spendings.saveSpending(this.$("input[name=spendingId]").val(),{spendingName:this.$("select[name=spendingName], input[name=spendingName]").val(),amount:this.$("input[name=amount]").val().replace(",","."),date:this.$("input[name=date]").val()})},selectSpendingName:function(){this.$("select[name=spendingName]").val()||this.replaceSpengingNameSelectByInput()},replaceSpengingNameSelectByInput:function(){var e=this;this.$("select[name=spendingName]").replaceWith('<input type="text" name="spendingName" />'),this.$("input[name=spendingName]").autocomplete({minLength:2,source:function(t,n){var a=t.term;return a in e.cacheAutocoplete?void n(e.cacheAutocoplete[a]):void $.ajax({type:"GET",url:e.urlAutocomplete,async:!1,headers:myWallet.getAuthHeader(),data:{name:t.term},dataType:"json",success:function(t){e.cacheAutocoplete[a]=t,n(t)},error:myWallet.processAjaxError})}})}}),ReportsView=Backbone.View.extend({el:"#page",template:myWallet.templates.reports,initialize:function(){},render:function(){if(myWallet.isUserLoggedIn()){var e=_.template(this.template);this.$el.html(e),this.trigger("render")}}}),ReportGroupBySpengingNameView=Backbone.View.extend({el:"#page",template:myWallet.templates.reportGroupBySpengingName,report:null,events:{"click div.reportGroupBySpengingName table.spendings th div":"sortSpendings"},initialize:function(){this.report=reportGroupBySpengingName,this.report.setDateBegin($.datepicker.formatDate("yy-mm-01",new Date)),this.report.setDateEnd($.datepicker.formatDate("yy-mm-"+this.countDaysOfMont(),new Date))},countDaysOfMont:function(){var e=new Date;return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()},sortSpendings:function(e){var t=$(e.target).attr("data-field"),n=this.report.getSortOptions();n.field==t?n.direction="asc"==n.direction?"desc":"asc":(n.direction="desc",n.field=t),this.report.setSortOptions(n),this.render()},render:function(){if(myWallet.isUserLoggedIn()){var e=_.template(this.template,{data:this.report.getData(),user:myWallet.user,sortOptions:this.report.getSortOptions()});this.$el.html(e);var t=this;this.$("input[name=dateBegin]").val(this.report.getDateBegin()),this.$("input[name=dateBeginFront]").val($.datepicker.formatDate("d GG yy",new Date(this.report.getDateBegin()))).datepicker({dateFormat:"d GG yy",altField:this.$("input[name=dateBegin]"),altFormat:"yy-mm-dd",onClose:function(){t.report.setDateBegin(t.$("input[name=dateBegin]").val()),t.render()}}),this.$("input[name=dateEnd]").val(this.report.getDateEnd()),this.$("input[name=dateEndFront]").val($.datepicker.formatDate("d GG yy",new Date(this.report.getDateEnd()))).datepicker({dateFormat:"d GG yy",altField:this.$("input[name=dateEnd]"),altFormat:"yy-mm-dd",onClose:function(){t.report.setDateEnd(t.$("input[name=dateEnd]").val()),t.render()}}),this.trigger("render")}}});